{ pkgs, ... }:

{
  home.packages = with pkgs; [
    # --- Reconnaissance & Enumeration ---
    nmap
    zenmap # GUI for Nmap
    subfinder # Subdomain discovery
    httpx # HTTP probing
    nuclei # Template-based vulnerability scanner (Essential)
    amass # Attack surface mapping
    whois
    bind # dig, nslookup

    # --- Web Auditing ---
    burpsuite # The gold standard proxy
    zap # OWASP ZAP
    caido # Lightweight Rust alternative to Burp
    ffuf # Fast Web Fuzzer
    gobuster # Directory/DNS buster
    feroxbuster # Recursive content discovery (Rust)
    katana # Next-gen crawling and spidering

    # --- Network Analysis ---
    wireshark
    mitmproxy # Scriptable CLI proxy
    socat # Multipurpose relay

    # --- Exploitation ---
    metasploit
    sqlmap
    thc-hydra
    john # John the Ripper

    # --- Mobile / Source Analysis ---
    apktool
    jadx
    gitleaks # Secret scanning

    # --- AI & Automation ---
    fabric-ai # AI pattern analysis
    (pkgs.writeShellScriptBin "ai-hunt" ''
      target=$1
      if [ -z "$target" ]; then
        echo "Usage: ai-hunt <domain>"
        exit 1
      fi

      echo "ðŸ¤– AI-Hunter initiated on $target..."
      mkdir -p "$HOME/Develop/hunting/$target"
      out="$HOME/Develop/hunting/$target"

      echo "[1/4] ðŸ” Enumerating Subdomains..."
      ${pkgs.subfinder}/bin/subfinder -d "$target" -silent > "$out/subs.txt"

      echo "[2/4] ðŸŒ Probing Alive Hosts..."
      cat "$out/subs.txt" | ${pkgs.httpx}/bin/httpx -silent > "$out/alive.txt"

      echo "[3/4] ðŸ’¥ Running Nuclei Scans..."
      ${pkgs.nuclei}/bin/nuclei -l "$out/alive.txt" -o "$out/vulns.txt" -silent

      echo "[4/4] ðŸ§  Fabric AI Analysis..."
      if [ -s "$out/vulns.txt" ]; then
        # Pipe findings to AI for risk assessment
        cat "$out/vulns.txt" | fabric --pattern analyze_security_report
        echo "âœ… Analysis Complete. Report saved to $out"
      else
        echo "âœ… No obvious vulnerabilities found to analyze."
      fi
    '')

    # --- Resources ---
    seclists
  ];

  # Helper aliases
  programs.bash.shellAliases = {
    scan = "nmap -sC -sV -oN nmap.txt";
    wordlists = "cd $WORDLISTS";
  };

  # Export environment variables
  home.sessionVariables = {
    WORDLISTS = "${pkgs.seclists}/share/wordlists";
  };
}
